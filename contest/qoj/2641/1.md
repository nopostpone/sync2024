[toc]

补题链接：

https://qoj.ac/contest/2641

个人代码放在：

https://github.com/nopostpone/xcpcTraining/tree/main/Regional/2025%20ICPC%20Shenyang

### A. Square Kingdom

首先有

$$
h_j - h_i = \frac{1}{a}(j - i)(ai + aj + 2b)
$$

答案一定是 $\frac 1a$ 的倍数，即分母为 $a$，我们来对分子 $x$ 二分答案。每次判断是否存在至少 $k$ 对 $(i, j)$ 满足 $(j - i)(ai + aj + 2b) \leq x$。

如果直接暴力，一次检查就是 $O(n^2)$，肯定是不允许的。我们来枚举因式的第一项 $j - i = d$，代入有

$$
d(ai + ai + ad + 2b) \leq x \\
i \leq \frac{x - 2bd - ad^2}{2ad}
$$

再有 $1 \leq i \leq n - d$，于是对于每个 $d$，我们能快速求得有多少个 $i$ 满足要求。现在每次检查的复杂度在于枚举 $d$ 的范围。

$d$ 的范围不会很大，因为对于 $(i, j)$，在 $[i, j]$ 中任选两点 $i' < j'$，都有 $h_{j'} - h_{i'} \leq h_j - h_i$。即如果一个 $d$ 中有一个 $i$ 满足，意味着已经至少存在 $\binom{d}{2}$ 个满足的数对了，$\binom d2 = \frac{d(d - 1)}2 \leq k$，得 $d$ 的上界在 $\sqrt{2k}$ 左右。

因此总复杂度 $O(\sqrt {2k} \log V)$，$V$ 为值域，上界不超过 $6\times 10^{18}$。

### B. Buggy Painting Software I

有两个贪心策略：

- 如果要染色，一定在最上层染色。

- 如果钦定层数，从上至下，第 $i$ 层本身的颜色，一定设置为目标颜色中出现次数第 $i$ 多的。

枚举层数即可。设当前层数为 $x$，每增加一层，就需要令 $c_{nxt}x$ 个格子为无色，其中 $c_{nxt}$ 为下一层颜色的出现次数。

复杂度 $O\left(nm\log nm\right)$，瓶颈在排序。

### C. Buggy Painting Software II

每个串都独立地用一个非平凡二划分 $(S_0, S_1)$ 进行加密，因此我们要想办法：知道 $(S_0, S_1)$ 是什么并把串解密；试图建立二进制串到数字的唯一映射。

获取 $(S_0, S_1)$ 是比较显然的，我们在加密时，统一将前 $m$ 个位置都设置为 $1, 2, \dots, m$ 就行了。

如何建立数字到串的唯一映射呢？考虑循环移位。先想一个简单的，对于要加密的数 $x$，序列中间 $m$ 个位置，全部循环移位 $x$ 次。

这是一个映射，但在经过二进制加密后，并不能保证是一一映射的。例如当 $m = 4$ 时，有一个二进制划分的方式：

```
1 : [1 2 3 4] : [0 1 0 1]
3 : [3 4 1 2] : [0 1 0 1]
```

此时 $1$ 和 $3$ 就无法区分了。

这就相当于：长度为 $m$ 的任意非平凡（不是全 $0$ 或全 $1$）二进制串，循环左移若干位。什么情况下能由左移结果唯一确定左移量 $x$？

经过研究，可以发现是：当且仅当 $m$ 为质数时。下面给出证明。

若 $m$ 非质数，取它的一个真约数 $d$，构造周期为 $d$ 的二进制串，显然该串无法确定唯一的 $x$。因此，若要确定唯一的 $x$，$m$ 必须是质数。

接下来说明 $m$ 为质数时，一定能确定唯一的 $x$。

依然使用反证，不能确定唯一的 $x$，等价于有两个 $x$ 映射到了同一个串，记为 $v$。即在左移 $x_1$ 次后，还能左移 $x_1 - x_2 \bmod m$ 次，再次获得 $v$，这就意味着 $v$ 有一个周期。假设 $v$ 的最小周期为 $r$（$0 < r < m$），即对所有下标都有 $v_i = v_{i + kr \bmod m}$，其中 $k$ 为任意整数。

令 $d = \gcd(r, m)$，由裴属定理，存在整数 $u$ 和 $v$，满足 $ur + vm = d$，于是 $ur \equiv d \bmod m$。

又因为 $m$ 是质数，$d$ 在模 $m$ 的意义下一定是 $1$，因此 $ur \equiv 1 \bmod m$。回看关于周期的式子，代入得 $v_i = v_{i+kr\bmod m} = v_{i + 1 \bmod m}$，即 $r = 1$。也就是说这种情况下，$v$ 是全 $0$ 或全 $1$ 的串，这与非平凡二划分的定义矛盾。假设不成立。

$Q.E.D.$

由伯特兰-切比雪夫定理，在 $m$ 和 $2m$ 之间，一定存在一个质数。于是我们找到这个质数，把它当作要进行循环移位的段落的长度，就能够保证一定是唯一映射了。

实现上，加密是没有难度的。解密的问题可以抽象为：一个字符串 $s$ 循环移位若干次形成 $t$，求循环移位次数。这是一个经典问题，设 $s' = s + s$，寻找 $t$ 在 $s'$ 中第一次出现的位置即可。可以用 kmp 解决。复杂度 $O(nm)$。

### F. The Bond Beyond Time

如果 $x$ 与 $y$ 不相邻，我们让 $x$ 与 $y$ 走不到任何地方即可。

如果 $x$ 与 $y$ 相邻，且图是一棵树，那么一定存在一种方案使他们相遇。下面来讨论 $x$ 与 $y$ 相邻，且图中有环的情况，此时是一定可以构造出永远不相遇的情形的。

先简化问题，如果整个图是一个环，则让他们顺时针跑就行。如果 $(x, y)$ 边在一个环上，且环中没有弦，那么同理，让他们只能顺着环跑就行，即把环的点标记出来，环上的边按照一个方向形成环。所有的 $(u, v)$ 边满足 $u$ 在环上，而 $v$ 不在环上，则令 $v$ 指向 $u$。

如果 $(x, y)$ 边不在环上呢？那就需要想办法让他们在不相遇的情况下走到一个环，然后再顺着环跑。不妨以 $x$ 为根，做一个图上的 dfs 生成树，选任意的非树边，标记与树边形成的环，这个环就是我们要走到的地方。

具体实现可以参考我的代码，思路对了的情况下，并不是那么难写。

### G.

### I.

按题意模拟即可。

### M.

枚举所有的排列，维护每个种子的胜率，按照题意模拟比赛流程即可。


